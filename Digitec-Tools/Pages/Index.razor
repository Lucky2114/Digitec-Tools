@page "/"
@using Digitec_Tools.Data

<div class="d-flex align-items-center min-vh-100">
    <div class="container">
        <EditForm Model="@PriceChangeModel" OnValidSubmit="@OnValidSubmit">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <InputText class="form-control" id="product" @bind-Value="@PriceChangeModel.ProductUrl" placeholder="Product Url" />
            <br />
            <InputText class="form-control" id="email" @bind-Value="@PriceChangeModel.Email" placeholder="Your E-Mail Address" />
            <br />
            <button class="btn btn-primary" type="submit" disabled=@disabled>
                @if (spin)
                {
                    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                }
                Submit
            </button>
        </EditForm>
    </div>
</div>

@code {
    private PriceChangeModel PriceChangeModel;

    private bool spin = false;
    private bool disabled = false;

    private async Task OnValidSubmit()
    {
        //update button state
        spin = true;
        disabled = true;
        //this.StateHasChanged();

        await Tools.RegisterNewProduct(PriceChangeModel.ProductUrl, PriceChangeModel.Email);
        spin = false;
        disabled = false;
        //this.StateHasChanged();
    }

    protected override void OnInitialized()
    {
        PriceChangeModel = new PriceChangeModel();
        base.OnInitialized();
    }

}